$.extend($.importexport.plugins,{syrrss:{form:null,ajax_pull:{},progress:!1,id:null,debug:{memory:0,memory_avg:0},$form:null,init(){$.shop.trace("$.importexport.plugins.syrrss.init"),this.$form=$("#s-plugin-syrrss");const r=this.$form.find("input[type=text][name=config\\[image_size\\]]").val(),s=this,o=$("#s-plugin-syrrss-image-size-select");o.val(r),o.off().on("change",(function(){s.$form.find("input[type=text][name=config\\[image_size\\]]").val($(this).val())}))},hashAction(r){$.importexport.products.action(r),window.location.hash=window.location.hash.replace(/\/hash\/.+$/,"/")},blur(){},action(){},onInit(){$.importexport.products.init(this.$form),this.$form.off("submit.syrrss").on("submit.syrrss",(function(r){$.shop.trace("submit.syrrss "+r.namespace,r);try{$(this).find(":input, :submit").attr("disabled",!1),$.importexport.plugins.syrrss.syrrssHandler(this)}catch(r){$("#plugin-syrrss-transport-group").find(":input").attr("disabled",!1),$.shop.error("Exception: "+r.message,r)}return!1}))},syrrssHandler(r){const s=this;s.progress=!0,s.form=$(r);const o=s.form.serialize();s.form.find(".errormsg").text(""),s.form.find(":input").attr("disabled",!0),s.form.find(":submit").hide(),s.form.find(".progressbar .progressbar-inner").css("width","0%"),s.form.find(".progressbar").show();const e=$(r).attr("action");return $.ajax({url:e,data:o,dataType:"json",type:"post",success:function(r){r.error?(s.form.find(":input").attr("disabled",!1),s.form.find(":submit").show(),s.form.find(".js-progressbar-container").hide(),s.form.find(".shop-ajax-status-loading").remove(),s.progress=!1,s.form.find(".errormsg").text(r.error)):(s.form.find(".progressbar").attr("title","0.00%"),s.form.find(".progressbar-description").text("0.00%"),s.form.find(".js-progressbar-container").show(),s.ajax_pull[r.processId]=[],s.ajax_pull[r.processId].push(setTimeout((function(){$.wa.errorHandler=function(r){return!(r.status>=500||0==r.status)},s.progressHandler(e,r.processId,r)}),100)),s.ajax_pull[r.processId].push(setTimeout((function(){s.progressHandler(e,r.processId,null)}),2e3)))},error:function(){s.form.find(":input").attr("disabled",!1),s.form.find(":submit").show(),s.form.find(".js-progressbar-container").hide(),s.form.find(".shop-ajax-status-loading").remove(),s.form.find(".progressbar").hide()}}),!1},onDone(r,s,o){},progressHandler(r,s,o){const e=$.importexport.plugins.syrrss;let t;if(o&&o.ready){let i;for($.wa.errorHandler=null;i=e.ajax_pull[s].pop();)i&&clearTimeout(i);t=e.form.find(".progressbar .progressbar-inner"),t.css({width:"100%"}),$.shop.trace("cleanup",o.processId),$.ajax({url:r,data:{processId:o.processId,cleanup:1},dataType:"json",type:"post",success:function(r){$.shop.trace("report",r),$("#plugin-syrrss-submit").hide(),e.form.find(".progressbar").hide();const s=$("#plugin-syrrss-report");s.show(),r.report&&s.find(".value:first").html(r.report),$.storage.del("shop/hash")}})}else if(o&&o.error)e.form.find(":input").attr("disabled",!1),e.form.find(":submit").show(),e.form.find(".js-progressbar-container").hide(),e.form.find(".shop-ajax-status-loading").remove(),e.form.find(".progressbar").hide(),e.form.find(".errormsg").text(o.error);else{let i;if(o&&void 0!==o.progress){t=e.form.find(".progressbar .progressbar-inner");const r=parseFloat(o.progress.replace(/,/,"."));t.animate({width:r+"%"}),e.debug.memory=Math.max(0,e.debug.memory,parseFloat(o.memory)||0),e.debug.memory_avg=Math.max(0,e.debug.memory_avg,parseFloat(o.memory_avg)||0);const s="Memory usage: "+e.debug.memory_avg+"/"+e.debug.memory+"MB",a=o.progress;t.parents(".progressbar").attr("title",o.progress),i=e.form.find(".progressbar-description"),i.text(a),i.attr("title",s)}o&&void 0!==o.warning&&(i=e.form.find(".progressbar-description"),i.append('<i class="icon16 exclamation"></i><p>'+o.warning+"</p>"));const a=r,n=s;e.ajax_pull[n].push(setTimeout((function(){$.ajax({url:a,data:{processId:n},dataType:"json",type:"post",success(s){e.progressHandler(r,s&&s.processId||n,s)},error(){e.progressHandler(r,n,null)}})}),500))}}}});